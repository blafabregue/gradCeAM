# Grad Centroid Activation Mapping for Convolutional Neural Networks

This is the code corresponding to the experiments conducted for the work
"Grad Centroid Activation Mapping for Convolutional Neural Networks" 
(Baptiste Lafabregue, Jonathan Weber, Pierre Gan√ßarki & Germain Forestier),
in submission

## Usage

### Install packages
You can use your favorite package manager (conda is recommended), create a new environment of python 3.8 or greater 
and use the packages listed in [requirements.txt](requirements.txt)
```sh
pip install -r requirements.txt
```

### For training on GPU
If you wish to train the networks on GPU you must install the tensorflow-gpu package. For example with pip:
```sh
pip install tensorflow-gpu
```
or 
```sh
conda install tensorflow-gpu
```
### Extract dataset to numpy format

If you wnat to use more time series datasets, you can use the one porvided in http://www.timeseriesclassification.com/.
But first, to train the networks you need to convert them into .npy files. The dataset used in the paper are already 
provided and converted
To do so you can use the `utils.py` script but you need first to change the two last line 
of the script. 
Note that this script is suited to extract data from .sktime files

### Train networks

To launch the training of the model and plot the grad-CeAM heatmaps, you can use the following command :
```sh
python plot_grad_came.py --dataset <dataset_name>
```
If you have already trained a model you can add the --weights flag to load the existing weights
```sh
python plot_grad_came.py --dataset <dataset_name> --weights
```

### Results

The results are stored in three folders:

* results/<dataset> 
will contain the logs (performance/loss evolution) 
* models/<dataset> 
will contain the saved weights
* plots/<dataset>  
will contain the plot generated by the grad-CeAM method with grad_test_best<id_cluster> are the closest instances to 
the <id_cluster> cluster, grad_test_worst<id_cluster> are the furthermost instances and grad_test_centers<id_cluster> 
are the reconstruction of the centroids. Note that the instances are from the test set. 

Both the heatmaps and the guided backpropagations are plotted.